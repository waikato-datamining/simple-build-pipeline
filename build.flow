# Project: adams
# Date: 2026-02-05 13:34:03
# User: fracpete
# Charset: UTF-8
# Modules: adams-core,adams-git,adams-groovy,adams-spreadsheet
#
adams.flow.control.Flow -annotation "builds the source code" -execute-on-error adams.flow.control.postflowexecution.Null -execute-on-finish adams.flow.control.postflowexecution.Null -flow-execution-listener adams.flow.execution.NullListener -flow-restart-manager adams.flow.control.flowrestart.NullManager
 adams.flow.standalone.CallableActors
  adams.flow.sink.Display -display-type adams.flow.core.displaytype.Default -writer adams.data.io.output.NullWriter
 adams.flow.standalone.SetVariable -name config -var-name config -var-value @{flow_dir}/config -expand-value true
 adams.flow.standalone.SetVariable -name src -var-name src -var-value @{flow_dir}/src -expand-value true
 adams.flow.standalone.SetVariable -name bin -var-name bin -var-value @{flow_dir}/bin -expand-value true
 adams.flow.standalone.SetVariable -name "clean mvn repo" -var-name clean_mvn_repo -var-value false
 adams.flow.standalone.SetVariable -name build_cmd -var-name build_cmd -var-value "mvn clean install -DskipTests=true -Dstyle.color=never"
 adams.flow.standalone.SetVariable -name build_output -var-name build_output -var-value .*-bin.zip
 adams.flow.source.Start
 adams.flow.control.Trigger -name "load custom settings"
  adams.flow.source.Variable -var-name flow_filename_long -conversion adams.data.conversion.StringToString
  adams.flow.transformer.Convert -conversion "adams.data.conversion.ReplaceFileExtension -extension .props -use-forward-slashes true"
  adams.flow.transformer.SetVariable -var-name settings_props
  adams.flow.control.ConditionalTrigger -name "custom props?" -condition "adams.flow.condition.bool.FileExists -file @{settings_props} -generator adams.core.io.NullFilenameGenerator"
   adams.flow.source.Variable -var-name settings_props -conversion adams.data.conversion.StringToString
   adams.flow.transformer.PropertiesFileReader
   adams.flow.transformer.PropertiesToVariables -regexp (build_cmd|build_output|clean_mvn_repo)
 adams.flow.control.Tee -name "global params"
  adams.flow.transformer.SetVariable -name global_build_output -var-name global_build_output -var-value @{build_output}
  adams.flow.transformer.SetVariable -name global_build_cmd -var-name global_build_cmd -var-value @{build_cmd}
 adams.flow.control.ConditionalTrigger -name "create bin dir?" -condition "adams.flow.condition.bool.Not -condition \"adams.flow.condition.bool.DirectoryExists -directory @{bin}\""
  adams.flow.standalone.MakeDir -dir @{src}
 adams.flow.control.ConditionalTrigger -name "clean mvn repo?" -condition "adams.flow.condition.bool.Expression -expression \"@{clean_mvn_repo} = true\""
  adams.flow.standalone.DeleteDir -dir ${HOME}/.m2/repository
 adams.flow.control.Trigger -name iterate
  adams.flow.source.FileSystemSearch -search "adams.flow.source.filesystemsearch.LocalFileSearch -directory @{config} -regexp .*\\\\.props -sorting SORT_BY_NAME" -use-forward-slashes true
  adams.flow.control.Tee -name info
   adams.flow.transformer.BaseName
   adams.flow.transformer.StringInsert -position first -value \\n
   adams.flow.sink.CallableSink -callable Display
  adams.flow.control.Tee -name "clean up"
   adams.flow.transformer.DeleteVariable -type REGEXP -regexp (repo|dir|sshkey|build_cmd|build_output)
  adams.flow.control.Tee -name "reset with global params"
   adams.flow.transformer.SetVariable -name "reset build_output" -var-name build_output -var-value @{global_build_output}
   adams.flow.transformer.SetVariable -name "reset build_cmd" -var-name build_cmd -var-value @{global_build_cmd}
  adams.flow.transformer.PropertiesFileReader
  adams.flow.transformer.PropertiesToVariables
  adams.flow.transformer.SetVariable -name "current project dir" -var-name project_dir -var-value @{src}/@{dir} -value-type FILE_FORWARD_SLASHES -expand-value true
  adams.flow.control.Trigger -name build
   adams.flow.source.Command -cmd @{build_cmd} -working-directory @{project_dir} -variable true -output-type BOTH
   adams.flow.transformer.StringIndent -indentation " " -num-times 4
   adams.flow.sink.CallableSink -callable Display
  adams.flow.control.Trigger -name "copy build output files"
   adams.flow.source.FileSystemSearch -search "adams.flow.source.filesystemsearch.LocalFileSearch -directory @{project_dir} -regexp @{build_output} -sorting SORT_BY_NAME -recursive true" -use-forward-slashes true
   adams.flow.transformer.CopyFile -target-dir @{bin}
   adams.flow.transformer.StringIndent -indentation " " -num-times 4
   adams.flow.sink.CallableSink -callable Display